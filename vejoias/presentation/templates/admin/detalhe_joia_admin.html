{% extends "base.html" %}

{% block title %}{% if joia %}Editar Joia: {{ joia.nome }}{% else %}Adicionar Nova Joia{% endif %}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    
    <div class="flex justify-between items-center mb-6 border-b pb-3">
        <h1 class="text-3xl font-extrabold text-gray-900">
            {% if joia %}
                <i class="fas fa-edit text-pink-600 mr-2"></i> Editando: {{ joia.nome }}
            {% else %}
                <i class="fas fa-plus-circle text-pink-600 mr-2"></i> Adicionar Nova Joia
            {% endif %}
        </h1>
        <a href="{% url 'gerenciar_joias' %}" class="text-sm text-pink-600 hover:text-pink-800 transition duration-150 flex items-center font-medium">
            <i class="fas fa-arrow-left mr-1"></i> Voltar ao Inventário
        </a>
    </div>

    <div class="bg-white p-8 rounded-xl shadow-2xl">
        <!-- O action do formulário depende se estamos criando ou editando -->
        <form method="post" enctype="multipart/form-data" 
              action="{% if joia %}{% url 'admin_editar_joia' joia.id %}{% else %}{% url 'admin_adicionar_joia' %}{% endif %}">
            {% csrf_token %}

            <!-- Se houver erros globais no formulário -->
            {% if form.non_field_errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                    <strong class="font-bold">Erro de Formulário:</strong>
                    <span class="block sm:inline">{{ form.non_field_errors }}</span>
                </div>
            {% endif %}

            <!-- Layout do Formulário em Duas Colunas -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Coluna de Informações Básicas (Nome, Preço, Categoria) -->
                <div>
                    <!-- Nome da Joia -->
                    <div class="mb-4">
                        <label for="{{ form.nome.id_for_label }}" class="block text-sm font-medium text-gray-700">Nome da Joia *</label>
                        <input type="text" name="{{ form.nome.name }}" id="{{ form.nome.id_for_label }}" 
                               value="{{ form.nome.value|default:'' }}" required
                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500">
                        {% if form.nome.errors %}<p class="mt-1 text-xs text-red-500">{{ form.nome.errors.0 }}</p>{% endif %}
                    </div>

                    <!-- Preço -->
                    <div class="mb-4">
                        <label for="{{ form.preco.id_for_label }}" class="block text-sm font-medium text-gray-700">Preço (R$) *</label>
                        <input type="number" name="{{ form.preco.name }}" id="{{ form.preco.id_for_label }}" 
                               value="{{ form.preco.value|default:'' }}" step="0.01" min="0" required
                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500">
                        {% if form.preco.errors %}<p class="mt-1 text-xs text-red-500">{{ form.preco.errors.0 }}</p>{% endif %}
                    </div>

                    <!-- Estoque -->
                    <div class="mb-4">
                        <label for="{{ form.estoque.id_for_label }}" class="block text-sm font-medium text-gray-700">Quantidade em Estoque *</label>
                        <input type="number" name="{{ form.estoque.name }}" id="{{ form.estoque.id_for_label }}" 
                               value="{{ form.estoque.value|default:1 }}" min="0" required
                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500">
                        {% if form.estoque.errors %}<p class="mt-1 text-xs text-red-500">{{ form.estoque.errors.0 }}</p>{% endif %}
                    </div>
                </div>

                <!-- Coluna de Detalhes Adicionais (Imagem, Categoria, Material) -->
                <div>
                    <!-- Categoria (Assumindo form.categoria é um Select) -->
                    <div class="mb-4">
                        <label for="{{ form.categoria.id_for_label }}" class="block text-sm font-medium text-gray-700">Categoria *</label>
                        {{ form.categoria }}
                        {% if form.categoria.errors %}<p class="mt-1 text-xs text-red-500">{{ form.categoria.errors.0 }}</p>{% endif %}
                    </div>

                    <!-- Material/Peso (Simulação de campos extras, se existirem) -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="mb-4">
                            <label for="{{ form.material.id_for_label }}" class="block text-sm font-medium text-gray-700">Material</label>
                            <input type="text" name="{{ form.material.name }}" id="{{ form.material.id_for_label }}" 
                                   value="{{ form.material.value|default:'' }}"
                                   class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500">
                            {% if form.material.errors %}<p class="mt-1 text-xs text-red-500">{{ form.material.errors.0 }}</p>{% endif %}
                        </div>
                        <div class="mb-4">
                            <label for="{{ form.peso_gramas.id_for_label }}" class="block text-sm font-medium text-gray-700">Peso (g)</label>
                            <input type="number" name="{{ form.peso_gramas.name }}" id="{{ form.peso_gramas.id_for_label }}" 
                                   value="{{ form.peso_gramas.value|default:'' }}" step="0.01" min="0"
                                   class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500">
                            {% if form.peso_gramas.errors %}<p class="mt-1 text-xs text-red-500">{{ form.peso_gramas.errors.0 }}</p>{% endif %}
                        </div>
                    </div>

                    <!-- URL da Imagem (ou upload, dependendo da sua implementação) -->
                    <div class="mb-4">
                        <label for="{{ form.imagem_url.id_for_label }}" class="block text-sm font-medium text-gray-700">URL da Imagem Principal</label>
                        <input type="url" name="{{ form.imagem_url.name }}" id="{{ form.imagem_url.id_for_label }}" 
                               value="{{ form.imagem_url.value|default:'' }}"
                               class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500">
                        {% if form.imagem_url.errors %}<p class="mt-1 text-xs text-red-500">{{ form.imagem_url.errors.0 }}</p>{% endif %}
                    </div>
                </div>
            </div>

            <!-- Descrição (Campo Completo) -->
            <div class="mb-6">
                <label for="{{ form.descricao.id_for_label }}" class="block text-sm font-medium text-gray-700">Descrição Detalhada *</label>
                <textarea name="{{ form.descricao.name }}" id="{{ form.descricao.id_for_label }}" rows="5" required
                          class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-pink-500 focus:border-pink-500 resize-none">{{ form.descricao.value|default:'' }}</textarea>
                {% if form.descricao.errors %}<p class="mt-1 text-xs text-red-500">{{ form.descricao.errors.0 }}</p>{% endif %}
            </div>

            <!-- Visualização da Imagem (apenas na Edição) -->
            {% if joia and joia.imagem_url %}
            <div class="mb-6">
                <p class="text-sm font-medium text-gray-700 mb-2">Imagem Atual:</p>
                <img src="{{ joia.imagem_url }}" alt="Imagem atual de {{ joia.nome }}" class="h-32 w-32 object-cover rounded-lg shadow-md border">
            </div>
            {% endif %}

            <!-- Botão de Ação -->
            <button type="submit" 
                    class="w-full bg-pink-600 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-pink-700 transition duration-300 transform hover:scale-[1.005]">
                {% if joia %}
                    <i class="fas fa-save mr-2"></i> Salvar Alterações
                {% else %}
                    <i class="fas fa-plus-circle mr-2"></i> Adicionar Jóia ao Catálogo
                {% endif %}
