<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso | Vejóias E-commerce</title>
    <!-- Carregamento do Tailwind CSS para estilo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuração da fonte Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
    <!-- Ícones Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-pink-50 min-h-screen flex items-center justify-center p-4">

    <!-- Card Principal de Autenticação -->
    <div class="w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden p-8 sm:p-10 border border-pink-200">
        
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-pink-600 tracking-wider">Vejóias</h1>
            <p class="text-gray-500 mt-2">Gerencie sua loja ou faça login como cliente.</p>
        </div>

        <!-- Seletor de Formulário (Login/Registro/Admin) -->
        <div class="flex space-x-2 mb-6">
            <button id="tab-login" class="flex-1 py-2 text-sm font-semibold rounded-lg transition duration-200 bg-pink-100 text-pink-700">Login Cliente</button>
            <button id="tab-register" class="flex-1 py-2 text-sm font-semibold rounded-lg transition duration-200 text-gray-600 hover:bg-gray-100">Registro Cliente</button>
            <button id="tab-admin" class="flex-1 py-2 text-sm font-semibold rounded-lg transition duration-200 text-gray-600 hover:bg-gray-100">Acesso Admin</button>
        </div>

        <!-- Formulários -->
        
        <!-- 1. Formulário de Login do Cliente (Padrão) -->
        <form id="form-login" class="space-y-6">
            <h2 class="text-2xl font-bold text-gray-700">Entrar como Cliente</h2>
            <div>
                <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                <input type="email" id="login-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500" placeholder="seu.email@exemplo.com">
            </div>
            <div>
                <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                <input type="password" id="login-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500" placeholder="••••••••">
            </div>
            <button type="submit" class="w-full py-3 bg-pink-600 text-white font-bold rounded-lg shadow-md hover:bg-pink-700 transition duration-300">
                <i class="fas fa-sign-in-alt mr-2"></i> Entrar
            </button>
        </form>

        <!-- 2. Formulário de Registro do Cliente (Inicialmente escondido) -->
        <form id="form-register" class="space-y-6 hidden">
            <h2 class="text-2xl font-bold text-gray-700">Novo Cliente</h2>
            <div>
                <label for="register-name" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo</label>
                <input type="text" id="register-name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500" placeholder="Nome Sobrenome">
            </div>
            <div>
                <label for="register-email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
                <input type="email" id="register-email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500" placeholder="seu.email@exemplo.com">
            </div>
            <div>
                <label for="register-password" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                <input type="password" id="register-password" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500" placeholder="Mínimo 6 caracteres">
            </div>
            <button type="submit" class="w-full py-3 bg-pink-600 text-white font-bold rounded-lg shadow-md hover:bg-pink-700 transition duration-300">
                <i class="fas fa-user-plus mr-2"></i> Criar Conta
            </button>
        </form>

        <!-- 3. Formulário de Acesso Admin (Inicialmente escondido) -->
        <div id="form-admin" class="space-y-6 hidden">
            <h2 class="text-2xl font-bold text-gray-700">Acesso de Administrador</h2>
            <p class="text-gray-600">
                Para o ambiente de desenvolvimento, o acesso de administrador é realizado automaticamente usando o token de segurança da plataforma.
            </p>
            <p class="text-sm text-pink-500">
                <i class="fas fa-exclamation-triangle mr-2"></i> Apenas clique no botão abaixo.
            </p>
            <button id="btn-admin-login" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300">
                <i class="fas fa-shield-alt mr-2"></i> Entrar como Administrador
            </button>
        </div>


        <!-- Mensagem de Status/Erro (Toast customizado) -->
        <div id="status-message" class="mt-6 p-4 rounded-lg text-center font-semibold transition-opacity duration-300 ease-in-out opacity-0 hidden" role="alert">
            <p id="status-text"></p>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        // Variáveis globais obrigatórias
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const adminToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Inicialização do Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- Referências DOM ---
        const tabLogin = document.getElementById('tab-login');
        const tabRegister = document.getElementById('tab-register');
        const tabAdmin = document.getElementById('tab-admin');
        const formLogin = document.getElementById('form-login');
        const formRegister = document.getElementById('form-register');
        const formAdmin = document.getElementById('form-admin');
        const btnAdminLogin = document.getElementById('btn-admin-login');
        const statusMessage = document.getElementById('status-message');
        const statusText = document.getElementById('status-text');

        // --- Funções de UI ---

        /**
         * Exibe uma mensagem de status (sucesso ou erro) customizada.
         * @param {string} message - A mensagem a ser exibida.
         * @param {boolean} isError - true para erro (vermelho), false para sucesso (verde).
         */
        function showStatus(message, isError = false) {
            statusText.textContent = message;
            statusMessage.classList.remove('bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700', 'hidden', 'opacity-0');
            statusMessage.classList.add('opacity-100');

            if (isError) {
                statusMessage.classList.add('bg-red-100', 'text-red-700');
            } else {
                statusMessage.classList.add('bg-green-100', 'text-green-700');
            }

            // Esconde a mensagem após 5 segundos
            setTimeout(() => {
                statusMessage.classList.remove('opacity-100');
                statusMessage.classList.add('opacity-0');
                setTimeout(() => statusMessage.classList.add('hidden'), 300); // Esconde totalmente após a transição
            }, 5000);
        }
        
        /**
         * Alterna entre os formulários de autenticação.
         * @param {string} activeFormId - O ID do formulário ativo ('login', 'register', 'admin').
         */
        function setActiveForm(activeFormId) {
            // Esconde todos os formulários
            formLogin.classList.add('hidden');
            formRegister.classList.add('hidden');
            formAdmin.classList.add('hidden');
            
            // Reseta a aparência dos botões
            [tabLogin, tabRegister, tabAdmin].forEach(btn => {
                btn.classList.remove('bg-pink-100', 'text-pink-700');
                btn.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            
            // Exibe o formulário ativo e estiliza o botão
            let activeBtn;
            if (activeFormId === 'login') {
                formLogin.classList.remove('hidden');
                activeBtn = tabLogin;
            } else if (activeFormId === 'register') {
                formRegister.classList.remove('hidden');
                activeBtn = tabRegister;
            } else if (activeFormId === 'admin') {
                formAdmin.classList.remove('hidden');
                activeBtn = tabAdmin;
            }
            
            if (activeBtn) {
                activeBtn.classList.add('bg-pink-100', 'text-pink-700');
                activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
            }
        }

        // --- Handlers de Autenticação ---
        
        /**
         * Lida com o login/registro/acesso administrativo.
         * Após o sucesso, redireciona.
         */
        function handleAuthSuccess(user, destination) {
            console.log("Autenticação bem-sucedida. UID:", user.uid);
            showStatus('Login realizado com sucesso! Redirecionando...', false);
            setTimeout(() => {
                window.location.href = destination;
            }, 1000);
        }

        // Login do Cliente (Simulação)
        formLogin.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                // Simulação de login. Em uma aplicação real, aqui haveria uma API de login/senha.
                // Para este exemplo, apenas fazemos login anônimo e avisamos.
                await signInWithEmailAndPassword(auth, email, password);
                handleAuthSuccess(auth.currentUser, './home.html');

            } catch (error) {
                console.error('Erro de Login:', error.message);
                showStatus('Falha no Login: Credenciais inválidas (simulação).', true);
            }
        });

        // Registro do Cliente (Simulação)
        formRegister.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const name = document.getElementById('register-name').value;
            
            try {
                // Criação de conta (simulação)
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Em uma aplicação real, você também salvaria o 'name' no Firestore ou User Profile
                console.log(`Usuário ${name} registrado. UID: ${userCredential.user.uid}`);

                handleAuthSuccess(userCredential.user, './home.html');

            } catch (error) {
                console.error('Erro de Registro:', error.message);
                let errorMessage = 'Falha no Registro. Verifique os dados.';
                if (error.code === 'auth/weak-password') {
                    errorMessage = 'A senha deve ter no mínimo 6 caracteres.';
                } else if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Este e-mail já está em uso.';
                }
                showStatus(errorMessage, true);
            }
        });
        
        // Acesso de Administrador (Obrigatório: usa o token do ambiente)
        btnAdminLogin.addEventListener('click', async () => {
            if (!adminToken) {
                showStatus('Token de Administrador não encontrado. Falha no acesso.', true);
                return;
            }
            
            try {
                // Autentica com o token de segurança fornecido pelo Canvas (adminToken)
                const userCredential = await signInWithCustomToken(auth, adminToken);
                handleAuthSuccess(userCredential.user, './admin/dashboard.html');
                
            } catch (error) {
                console.error('Erro no Acesso Admin:', error);
                showStatus('Erro ao autenticar como Admin. Token inválido ou expirado.', true);
            }
        });

        // --- Listeners de Troca de Tab ---
        tabLogin.addEventListener('click', () => setActiveForm('login'));
        tabRegister.addEventListener('click', () => setActiveForm('register'));
        tabAdmin.addEventListener('click', () => setActiveForm('admin'));
        
        // --- Inicialização ---
        // Certifica-se de que o estado inicial é Login do Cliente
        setActiveForm('login');

    </script>
</body>
</html>
